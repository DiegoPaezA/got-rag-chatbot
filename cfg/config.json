{
  "paths": {
    "raw_data": "data/raw/wiki_dump.jsonl",
    "processed_dir": "data/processed",
    "config_path": "cfg/config.json",
    "vector_db": "data/chromadb",
    "eval": {
      "golden_dataset": "data/eval/golden_dataset_neo4j_v1.jsonl",
      "predictions": "data/eval/predictions_neo4j_v1.jsonl",
      "results": "data/eval/evaluation_results_neo4j_v1.jsonl",
      "batch_requests": "data/eval/batch_requests_neo4j_v1.jsonl"
    }
  },
  "database": {
    "neo4j": {
      "batch_size_nodes": 1000,
      "batch_size_edges": 500,
      "timeout": 30
    }
  },
  "llm_settings": {
    "provider": "google",
    "model_name": "gemini-2.5-flash-preview-09-2025",
    "temperature": 0.0,
    "max_retries": 3,
    "components": {
      "generator": {
        "provider": "google",
        "model_name": "gemini-2.5-flash",
        "temperature": 0.1
      },
      "augmenter": {
        "provider": "google",
        "model_name": "gemini-2.5-flash",
        "temperature": 0.0
      },
      "judge": {
        "provider": "google",
        "model_name": "gemini-2.5-flash",
        "temperature": 0.0,
        "max_retries": 3
      },
      "validator": {
        "provider": "google",
        "model_name": "gemini-2.5-flash-preview-09-2025",
        "temperature": 0.0,
        "max_retries": 5
      },
      "retriever": {
        "provider": "google",
        "model_name": "gemini-2.5-flash",
        "temperature": 0.0
      },
      "graph_search": {
        "provider": "google",
        "model_name": "gemini-2.5-flash",
        "temperature": 0.0
      },
      "dataset_generator": {
        "provider": "google",
        "model_name": "gemini-2.5-flash",
        "temperature": 0.1,
        "max_retries": 3
      }
    }
  },
  "embedding_settings": {
    "provider": "google", 
    "model_name": "models/text-embedding-004",
    "device": "cpu",
    "chunk_size": 1000, 
    "chunk_overlap": 200,
    "separators": ["\n\n", "\n", ". ", " ", ""],
    "collection_name": "got_knowledge_base"
  },
  "processing": {
    "validator": {
      "batch_size": 10,
      "min_text_length": 20,
      "max_text_length": 600
    },
    "retriever": {
      "vector_search_k": 4,
      "chat_history_limit": 4
    },
    "graph_search": {
      "cypher_limit": 20
    },
    "loader": {
      "batch_size_nodes": 1000,
      "batch_size_edges": 500
    }
  },
  "scraper": {
    "base_url": "https://gameofthrones.fandom.com/api.php",
    "user_agent": "WesterosBot/2.0",
    "timeout": 15,
    "retry_delay": 5,
    "max_retries": 3
  },
  "graph_settings": {
    "allowed_types": [
      "Character", "House", "Organization", "Battle",
      "Location", "Object", "Creature", "Religion",
      "Episode", "Lore"
    ]
  },
  "prompts": {
    "generator": {
      "default": "You are Maester AI, a keeper of the Citadel's knowledge.\n\nINSTRUCTIONS:\n1. Answer the user's question using ONLY the provided Context below.\n2. Trust the 'Graph Connections' for factual relationships (family, seats).\n3. Use 'Ancient Scrolls' for narrative details.\n4. If the answer is not in the context, say \"The archives are silent on this.\"\n\nCONTEXT FROM THE ARCHIVES:\n{context}\n\nUSER QUESTION:\n{question}\n\nANSWER:"
    },
    "augmenter": {
      "narrator": "Task: You are a Data Analyst for the Citadel. Convert raw Graph Database records into clear, concise, natural language facts relevant to the User's Inquiry.\n\nUSER INQUIRY: \"{query}\"\n\nRAW GRAPH DATA (JSON):\n{graph_data}\n\nINSTRUCTIONS:\n1. **Filter Noise:** Ignore records that are empty, null, or generic placeholders.\n2. **Interpret Context:** Use the query to understand specific keys (e.g., interpret 'EpisodeName' as the episode where an event occurred).\n3. **Clarity:** Output readable sentences (e.g., \"Fact: Rickon Stark died in the episode 'The Black Queen'.\").\n4. **Strictness:** Do not invent information. Only describe the provided JSON.\n\nOUTPUT (Bulleted list of facts):"
    },
    "judge": {
      "system": "You are an expert AI Auditor evaluating a Retrieval-Augmented Generation (RAG) system.\n\nYou will be given:\n1. **User Question**: The query.\n2. **Retrieved Context**: The raw text/graph data retrieved by the system.\n3. **Ground Truth**: The verified correct answer.\n4. **Prediction**: The chatbot's final answer.\n\nYOUR TASK is to score the following 3 metrics (0 or 1):\n\n1. **Context Recall (Retrieval Quality)**: \n   - Is the information required to answer the 'Ground Truth' present in the 'Retrieved Context'?\n   - 1 = Yes.\n   - 0 = No (The context is missing the specific fact).\n\n2. **Faithfulness (Hallucination Check)**: \n   - Is the 'Prediction' derived EXCLUSIVELY from the 'Retrieved Context'?\n   - 1 = Yes (Even if the answer is 'I don't know' based on empty context).\n   - 0 = No (The model used external knowledge or hallucinated).\n\n3. **Correctness (End-to-End Accuracy) - CRITICAL RULES**:\n   - **Inclusive Match:** If the Prediction CONTAINS the Ground Truth, score 1. (e.g., GT='Jon', Pred='Jon and Arya' -> 1).\n   - **Semantic Match:** Synonyms allow score 1 (e.g., GT='Stark', Pred='House Stark' -> 1).\n   - **Missing Info:** If the Prediction says 'Unknown' but the Ground Truth is known, score 0.\n   - **Contradiction:** If the Prediction explicitly contradicts the Ground Truth, score 0.\n\nOUTPUT FORMAT:\nReturn ONLY a valid JSON object. No markdown.\n{{\n    \"context_recall\": 0 or 1,\n    \"faithfulness\": 0 or 1,\n    \"correctness\": 0 or 1,\n    \"reason\": \"Brief explanation.\"\n}}",
      "human": "--- EVALUATION TASK ---\nQUESTION: {question}\n\nGROUND TRUTH: {ground_truth}\n\nRETRIEVED CONTEXT: \n{context}\n\nPREDICTION: {prediction}\n-----------------------\nJSON RESULT:"
    },
    "validator_system": "You are an expert Data Architect for a 'Game of Thrones' Knowledge Graph.\nYour task is to clean and validate a database of entities.\n\nYou will be given a LIST of entities in JSON format. For each entity, you must:\n- Decide the CORRECT type according to the ontology.\n- Copy the 'id' field EXACTLY as given.\n- Provide a confidence level and a short rationale.\n\nAllowed ontology (use EXACTLY these labels for 'suggested_type'):\n{allowed_types}\n\nValidation rules and hints:\n1. Characters:\n   - If context mentions 'played by', 'actor', 'father', 'mother', 'born', or 'died',\n     the entity is almost certainly a 'Character' (even if it also looks like an Organization/Object).\n2. Lore vs Character:\n   - Real-world people (directors, producers, stuntman, etc.) are usually 'Lore' or possibly 'Character'\n     if they exist in-universe. If they are purely production staff and not part of the GoT universe,\n     prefer 'Lore'.\n3. Battles:\n   - Entities that are wars, sieges, sacks, or named conflicts should be 'Battle'.\n4. Objects:\n   - Swords, blades, ships, poisons, crowns, artifacts, etc. should be 'Object'.\n5. Organizations:\n   - Guilds, banks, religious orders, guards, brotherhoods, watches, councils, etc. should be 'Organization'.\n6. Locations:\n   - Castles, cities, regions, islands, rivers, etc. should be 'Location'.\n7. Episodes:\n   - TV episodes (with directors, writers, air dates, runtimes) should be 'Episode'.\n8. Lore:\n   - Use 'Lore' when the entity does not clearly match any category above or is purely meta/real-world.\n9. Heuristic confidence:\n   - You will see a 'current_type' and a 'heuristic_confidence' for each entity.\n   - If 'heuristic_confidence' is 'Low', rely heavily on the text and properties.\n   - You may either CONFIRM the current_type or CORRECT it if evidence is strong.\n\nOutput requirements:\n- Return a JSON object strictly following the given schema (BatchValidationResult).\n- The 'results' list MUST:\n  - Contain one item per input entity.\n  - Be in any order, but each item MUST have an 'id' that matches one of the input entities.\n- For each result:\n  - 'id' MUST be copied exactly from the corresponding input entity.\n  - 'suggested_type' MUST be one of the allowed ontology labels.\n  - 'confidence' MUST be one of: 'High', 'Medium', 'Low'.\n  - 'rationale' MUST be a short explanation.",
    "validator_human": "Analyze the following batch of entities and validate/correct their types.\n\nYou are given a JSON array where each element has:\n- 'id': unique identifier of the node\n- 'current_type': the type assigned by heuristic rules\n- 'heuristic_confidence': 'High', 'Medium', or 'Low'\n- 'properties': flattened infobox key/value pairs\n- 'text_context': truncated node text (if available)\n\nJSON input:\n{input_data}",
    "rag_response": "You are the Maester of the Citadel, an expert on the history and lore of 'Game of Thrones' (A Song of Ice and Fire).\n\nTASK:\nYou have received a **'Citadel Intelligence Report'** regarding a specific inquiry. Your task is to synthesize this report into a comprehensive and accurate answer for the user.\n\nINSTRUCTIONS FOR INTERPRETING THE REPORT:\n1. **Identify Sources:** The report contains two sections. \n   - **'The Great Ledger'** (Graph Data): Contains VERIFIED FACTS about relationships (Successors, Parents, Vassals). Trust this implicitly for names and structural connections.\n   - **'Ancient Scrolls'** (Text Data): Contains narrative details, context, and descriptions.\n\n2. **Synthesis Strategy:** \n   - Start by establishing the core facts found in the **Great Ledger**.\n   - Expand on these facts using the narrative richness from the **Ancient Scrolls**.\n\n3. **Handling Conflicts:** If the 'Great Ledger' lists a specific fact (e.g., 'Successor: Quenton Qoherys') that differs from the 'Ancient Scrolls' (e.g., 'Successor: Greyjoy'), YOU MUST MENTION BOTH. Present them as 'Specific Records' vs 'General History'.\n\n4. **Uncertainty:** If the report says 'No records found', admit that the archives are silent.\n\n5. **Tone:** Maintain the scholarly, authoritative, yet helpful tone of a Maester.\n\n=== CITADEL INTELLIGENCE REPORT ===\n{context}\n===================================\n\nUSER INQUIRY: {question}\n\nMAESTER'S ANSWER:",
    "cypher_generation_template": "Task: You are an expert Neo4j Developer translating user questions into READ-ONLY Cypher queries for a Game of Thrones knowledge graph.\n\nSCHEMA:\n{schema}\n\nINSTRUCTIONS:\n1. **Schema Compliance:** Use ONLY the node labels and relationship types provided in the SCHEMA.\n2. **Entity Resolution (CRITICAL):**\n   - **Fuzzy Matching:** Always use `toLower(n.prop) CONTAINS toLower(\"value\")`.\n   - **Split Keywords:** If the entity name has multiple words (e.g., \"Valyrian Dagger\"), split them using AND to find partial matches.\n     * Bad: `toLower(n.name) CONTAINS \"valyrian dagger\"`\n     * Good: `toLower(n.name) CONTAINS \"valyrian\" AND toLower(n.name) CONTAINS \"dagger\"`\n3. **Properties vs Relationships:**\n   - **Relationships:** Return `type(r)` aliased as `RelType`.\n   - **Attributes:** For Death, Culture, Words, or Actor, return them explicitly (e.g., `RETURN n.name, n.DeathPlace`).\n4. **Directionality:**\n   - **Overlords:** `MATCH (X)<-[:OVERLORD_OF]-(Y)` (Y is Overlord).\n   - **Vassals:** `MATCH (X)-[:OVERLORD_OF]->(Y)` (Y is Vassal).\n   - **Parents:** `(child)-[:FATHER|MOTHER]->(parent)`.\n5. **Output:** Return ONLY the Cypher string. Always add `LIMIT 20`.\n\nFEW-SHOT EXAMPLES:\n\nQ: \"Who owns the Valyrian Dagger?\"\nCypher: MATCH (n:Object) WHERE toLower(n.name) CONTAINS \"valyrian\" AND toLower(n.name) CONTAINS \"dagger\" MATCH (n)<-[:OWNED_BY]-(o) RETURN n.name, o.name AS Owner LIMIT 10\n\nQ: \"Who are the vassals of House Bolton?\"\nCypher: MATCH (h:House) WHERE toLower(h.id) CONTAINS \"bolton\" MATCH (h)-[r:OVERLORD_OF]->(v) RETURN v.name AS Vassal, type(r) AS RelType LIMIT 20\n\nCURRENT QUESTION:\n{question}\n\nCypher:"
  },
  "logging": {
    "log_dir": "logs",
    "log_file": "chatbot_execution.log",
    "file_level": "DEBUG",
    "console_level": "INFO"
  },
  "ui": {
    "page_title": "Maester AI - Game of Thrones",
    "page_icon": "üêâ",
    "layout": "wide",
    "title": "üêâ Maester AI - Citadel of Knowledge",
    "subtitle": "üè∞ Your scholarly advisor on all matters of the Seven Kingdoms",
    "disclaimer": "‚ö†Ô∏è This chatbot is powered by RAG (Retrieval Augmented Generation) and relies on the Game of Thrones Fandom Wiki. Responses may contain inaccuracies.",
    "theme": {
      "background_gradient": "linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%)",
      "primary_color": "#d4af37",
      "secondary_color": "#8b7355",
      "text_color": "#c0c0c0",
      "user_message_bg": "#2c3e50",
      "assistant_message_bg": "#1a1f3a"
    }
  }
}